# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

PyFlowCanvas is a universal node-based visual scripting editor built with Python and PySide6. It allows users to create, connect, and execute Python code as nodes in a data-driven graph. The project follows a "Code as Nodes" philosophy where pins are automatically generated by parsing Python function signatures.

## Common Commands

### Running the Application
- **Windows**: `run.bat` or `.\run.bat`
- **Linux/macOS**: `./run.sh`
- Both scripts automatically activate the virtual environment and run `main.py`

### Environment Setup
1. Create virtual environment: `python3 -m venv venv`
2. Activate environment:
   - Windows: `venv\Scripts\activate`
   - Linux/macOS: `source venv/bin/activate`
3. Install dependencies: `pip install PySide6`

### Virtual Environment Management
- The application creates project-specific virtual environments in the `venvs/` directory
- Each graph can have its own isolated environment with custom pip dependencies
- Use "Run > Manage Environment" in the application to configure environments

## Architecture Overview

### Core Application Structure
- **main.py**: Entry point, loads Font Awesome fonts and QSS stylesheet
- **node_editor_window.py**: Main QMainWindow with menus, toolbars, and dock widgets
- **node_editor_view.py**: QGraphicsView handling mouse/keyboard interactions (pan, zoom, copy/paste)
- **node_graph.py**: QGraphicsScene managing nodes, connections, and clipboard operations
- **graph_executor.py**: Execution engine that runs node graphs using subprocess isolation

### Node System
- **node.py**: Main Node class with automatic pin generation from Python function parsing
- **pin.py**: Input/output connection points with type-based coloring
- **connection.py**: Bezier curve connections between pins
- **reroute_node.py**: Simple organizational nodes for connection routing

### Code Editing
- **code_editor_dialog.py**: Modal dialog containing the code editor
- **python_code_editor.py**: Core editor widget with line numbers and smart indentation
- **python_syntax_highlighter.py**: Python syntax highlighting implementation

### Utilities
- **color_utils.py**: Color manipulation utilities
- **environment_manager.py**: Virtual environment management dialog
- **settings_dialog.py**: Application settings configuration
- **node_properties_dialog.py**: Node property editing interface

## Key Concepts

### Node Function Parsing
- Nodes automatically generate input pins from function parameters with type hints
- Output pins are created from return type annotations
- Supports single outputs (`-> str`) and multiple outputs (`-> Tuple[str, int]`)
- Type hints determine pin colors: `int`, `str`, `float`, `bool`, `Tuple`

### Data Flow Execution
- Graph execution is data-driven, not control-flow based
- Nodes execute when all input dependencies are satisfied
- Each node runs in an isolated subprocess for security
- Pin values are serialized/deserialized as JSON between nodes

### Graph Persistence
- Graphs save to clean JSON format in the `examples/` directory
- Node positions, connections, and code are preserved
- Virtual environment requirements are stored with each graph

## File Organization

### Examples and Resources
- `examples/`: Sample graph files demonstrating various use cases
- `resources/`: Font Awesome font files for UI icons
- `venvs/`: Project-specific virtual environments
- `dark_theme.qss`: Application-wide dark theme stylesheet

### Missing Files Referenced in README
The README mentions `socket_type.py` and `default_graphs.py` but these files don't exist in the current codebase. The socket type functionality appears to be implemented directly in other modules.

## Development Notes

- This is an experimental AI-generated codebase for learning purposes
- No formal test suite exists - testing is done through example graphs
- The application uses PySide6 for the Qt-based GUI
- Font Awesome integration provides professional iconography
- All nodes execute in isolated environments for security