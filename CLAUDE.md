# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

PyFlowGraph is a universal node-based visual scripting editor built with Python and PySide6. It allows users to create, connect, and execute Python code as nodes in a data-driven graph. The project follows a "Code as Nodes" philosophy where pins are automatically generated by parsing Python function signatures.

## Common Commands

### Running the Application

- **Windows**: `run.bat` or `.\run.bat`
- **Linux/macOS**: `./run.sh`
- Both scripts automatically activate the virtual environment and run `src/main.py`

### Environment Setup

1. Create virtual environment: `python3 -m venv venv`
2. Activate environment:
   - Windows: `venv\Scripts\activate`
   - Linux/macOS: `source venv/bin/activate`
3. Install dependencies: `pip install PySide6`

### Virtual Environment Management

- The application creates project-specific virtual environments in the `venvs/` directory
- Each graph can have its own isolated environment with custom pip dependencies
- Use "Run > Manage Environment" in the application to configure environments

## Architecture Overview

### Core Application Structure

All source code is organized in the `src/` directory:

- **src/main.py**: Entry point, loads Font Awesome fonts and QSS stylesheet
- **src/node_editor_window.py**: Main QMainWindow with menus, toolbars, and dock widgets
- **src/node_editor_view.py**: QGraphicsView handling mouse/keyboard interactions (pan, zoom, copy/paste)
- **src/node_graph.py**: QGraphicsScene managing nodes, connections, and clipboard operations
- **src/graph_executor.py**: Execution engine that runs node graphs using subprocess isolation

### Node System

- **src/node.py**: Main Node class with automatic pin generation from Python function parsing
- **src/pin.py**: Input/output connection points with type-based coloring
- **src/connection.py**: Bezier curve connections between pins
- **src/reroute_node.py**: Simple organizational nodes for connection routing

### Code Editing

- **src/code_editor_dialog.py**: Modal dialog containing the code editor
- **src/python_code_editor.py**: Core editor widget with line numbers and smart indentation
- **src/python_syntax_highlighter.py**: Python syntax highlighting implementation

### Event System

- **src/event_system.py**: Event-driven execution system for interactive applications with live mode support

### Utilities

- **src/color_utils.py**: Color manipulation utilities
- **src/environment_manager.py**: Virtual environment management dialog
- **src/settings_dialog.py**: Application settings configuration
- **src/node_properties_dialog.py**: Node property editing interface

## Key Concepts

### Node Function Parsing

- Nodes automatically generate input pins from function parameters with type hints
- Output pins are created from return type annotations
- Supports single outputs (`-> str`) and multiple outputs (`-> Tuple[str, int]`)
- Type hints determine pin colors: `int`, `str`, `float`, `bool`, `Tuple`

### Data Flow Execution

- Graph execution is data-driven, not control-flow based
- Nodes execute when all input dependencies are satisfied
- Each node runs in an isolated subprocess for security
- Pin values are serialized/deserialized as JSON between nodes
- Supports both **Batch Mode** (traditional sequential execution) and **Live Mode** (event-driven interactive execution)

### Graph Persistence

- Graphs save to clean JSON format in the `examples/` directory
- Node positions, connections, and code are preserved
- Virtual environment requirements are stored with each graph

## File Organization

### Project Structure

The project follows a clean, organized structure:

```
PyFlowGraph/
├── src/                     # All Python source code
├── tests/                   # All test files  
├── docs/                    # Static documentation
├── test_reports/           # Generated test outputs
├── examples/               # Sample graph files
├── resources/              # Font Awesome fonts, UI assets
├── venvs/                  # Project-specific virtual environments  
├── .github/workflows/      # CI/CD pipeline
├── run.bat, run.sh         # Application launcher scripts
├── run_tests.bat, etc.     # Test runner scripts
├── dark_theme.qss          # Application stylesheet
├── requirements.txt        # Python dependencies
└── CLAUDE.md              # This file
```

### Core Directories

- **`src/`**: All 22 Python modules organized in one location
- **`tests/`**: 7 test files with comprehensive GUI and execution testing
- **`docs/`**: Hand-written documentation (flow_spec.md, test guides)
- **`test_reports/`**: Auto-generated test outputs and summaries
- **`examples/`**: Sample .md graph files demonstrating features
- **`resources/`**: Static assets (Font Awesome fonts)
- **`venvs/`**: Isolated Python environments for graph execution

## Testing

### Test Organization

- **tests/test_execution_flow.py**: Basic node execution validation
- **tests/test_gui_loading*.py**: GUI component loading tests
- **tests/test_pin_creation_bug.py**: Pin system validation
- **tests/test_specific_gui_bugs.py**: Targeted bug reproduction tests

### Running Tests

- **Quick test**: `run_quick_test.bat` - Key GUI/pin tests
- **Full suite**: `run_tests.bat` - Interactive test menu
- **Single test**: `run_gui_test.bat` - GUI loading fix test
- **Manual**: `python tests/test_name.py` - Individual test files

## Development Notes

- This is an experimental AI-generated codebase for learning purposes
- The application uses PySide6 for the Qt-based GUI  
- Font Awesome integration provides professional iconography
- All nodes execute in isolated environments for security
- Dependencies are managed via `requirements.txt` (PySide6, Nuitka for compilation)

- Don't add claude attribution to git commits